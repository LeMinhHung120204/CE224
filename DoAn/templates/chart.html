<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Chart</title>
</head>

<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <h2>Navigation</h2>
        <ul>
            <li><a href="/">Home</a></li>
            <li><a class="active" href="/chart">Chart</a></li>
            <li><a href="/analysis">Analysis</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Page Title -->
        <h1 class="chart-title">Chart</h1>

        <!-- Filters for station and date range -->
        <div class="filters-container">
            <div>
                <label for="station-select">Select Station:</label>
                <select id="station-select">
                    <option value="station1">Station 1</option>
                    <option value="station2">Station 2</option>
                    <option value="station3">Station 3</option>
                    <option value="station4">Station 4</option>
                    <option value="station5">Station 5</option>
                </select>
            </div>

            <div>
                <label for="start-date">Start Date:</label>
                <input type="date" id="start-date">
            </div>

            <div>
                <label for="end-date">End Date:</label>
                <input type="date" id="end-date">
            </div>

            <button onclick="loadCharts()">Apply</button>
        </div>

        <!-- Chart Display -->
        <div class="chart-grid">
            <div class="chart-container hidden">
                <h3>Light Intensity (lux)</h3>
                <img id="chart-light-intensity" src="../static/images/default_chart.png" alt="Light Intensity Chart">
            </div>
            <div class="chart-container hidden">
                <h3>Rain Level (mm)</h3>
                <img id="chart-rain-level" src="../static/images/default_chart.png" alt="Rain Level Chart">
            </div>
            <div class="chart-container hidden">
                <h3>Temperature (Â°C)</h3>
                <img id="chart-temperature" src="../static/images/default_chart.png" alt="Temperature Chart">
            </div>
            <div class="chart-container hidden">
                <h3>Humidity (%)</h3>
                <img id="chart-humidity" src="../static/images/default_chart.png" alt="Humidity Chart">
            </div>
            <div class="chart-container hidden">
                <h3>Pressure (hPa)</h3>
                <img id="chart-pressure" src="../static/images/default_chart.png" alt="Pressure Chart">
            </div>
            <div class="chart-container hidden">
                <h3>Wind Speed (km/h)</h3>
                <img id="chart-wind-speed" src="../static/images/default_chart.png" alt="Wind Speed Chart">
            </div>
        </div>
        
    </div>

    <script>
        function loadCharts() {
            const selectedStation = document.getElementById("station-select").value;
            const startDate = document.getElementById("start-date").value;
            const endDate = document.getElementById("end-date").value;
    
            // Check if the user has selected both start and end dates
            if (!startDate || !endDate) {
                alert("Please select both a start and an end date.");
                return;
            }
    
            // Validate date range
            if (new Date(startDate) > new Date(endDate)) {
                alert("Start date cannot be later than end date.");
                return;
            }
    
            // Fetch the chart data for the selected station and date range
            fetch(`/chart?station=${selectedStation}&start=${startDate}&end=${endDate}`)
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(error => {
                            throw new Error(error.error || 'Cannot load charts');
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    // Update charts
                    document.getElementById("chart-light-intensity").src = `../static/charts/${data.lightIntensity}`;
                    document.getElementById("chart-rain-level").src = `../static/charts/${data.rainLevel}`;
                    document.getElementById("chart-temperature").src = `../static/charts/${data.temperature}`;
                    document.getElementById("chart-humidity").src = `../static/charts/${data.humidity}`;
                    document.getElementById("chart-pressure").src = `../static/charts/${data.pressure}`;
                    document.getElementById("chart-wind-speed").src = `../static/charts/${data.windSpeed}`;
                })
                .catch(error => {
                    alert(error.message);
                });
        }
    </script>    
</body>

</html>